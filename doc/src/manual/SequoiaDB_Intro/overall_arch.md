[^_^]:
    SequoiaDB 整体架构

SequoiaDB 巨杉数据库作为分布式数据库，由[数据库存储引擎][engine]与[数据库实例][instance]两大模块构成。

其中，数据库存储引擎模块是数据存储的核心，负责提供整个数据库的读写服务、数据的高可用与容灾、ACID 与分布式事务等全部核心数据服务。

数据库实例模块则作为协议与语法的适配层，用户可根据需要创建包括 MySQL、MariaDB、PostgreSQL 与 SparkSQL 在内的结构化数据实例；以及 JSON 和 S3 对象存储的非结构化实例。

通过使用 SequoiaDB 巨杉数据库，用户可以通过创建不同类型的数据库实例，使应用程序从传统数据库进行无缝迁移，大幅度降低应用程序开发者的学习成本。

![逻辑架构][logical_arch]

##数据库实例##

SequoiaDB 巨杉数据库支持多种类型的数据库实例。至当前版本为止，SequoiaDB 巨杉数据库支持 6 种不同的实例类型。

| 实例类型 | 实例分类 | 描述 |
|----|----|----|
| MySQL | 结构化数据 | 适用于纯联机交易场景，与 MySQL 保持 100% 兼容 |
| PostgreSQL | 结构化数据 | 适用于联机交易场景与中小量数据的分析类场景，与 PostgreSQL 基本保持兼容 |
| SparkSQL | 结构化数据 | 适用于海量数据的统计分析类场景，与 SparkSQL 保持 100% 兼容 |
| MariaDB  | 结构化数据 | 适用于联机交易场景，与 MariaDB 保持 100% 兼容 |
| JSON API | 半结构化数据 | 适用于基于 JSON 数据类型的联机业务场景  |
| S3 对象存储 | 非结构化数据 | 适用于对象存储类的联机业务与归档类场景，与 S3 保持 100% 兼容 |

##数据库存储引擎##

SequoiaDB 巨杉数据库存储引擎采用分布式架构。集群中的每个节点为一个独立进程，节点之间采用 TCP/IP 协议进行通讯。

同一个操作系统可以部署多个节点，节点之间采用不同的端口进行区分。

![数据库存储引擎逻辑架构][engine_arch]

SequoiaDB 巨杉数据库的节点分为三种不同的角色：协调节点、编目节点与数据节点。

###协调节点###

协调节点不存储任何用户数据。作为外部访问的接入与请求分发节点，协调节点将用户请求分发至相应的数据节点，最终合并数据节点的结果应答对外进行响应。

###编目节点###

编目节点主要存储系统的节点信息、用户信息、分区信息以及对象定义等元数据。在特定操作下，协调节点与数据节点均会向编目节点请求元数据信息，以感知数据的分布规律和校验请求的正确性。

###数据节点###

数据节点为用户数据的物理存储节点，海量数据通过分片切分的方式被分散至不同的数据节点。在关系型与 JSON 数据库实例中，每一条记录会被完整地存放在其中一个或多个数据节点中；而在对象存储实例中，每一个文件将会依据数据页大小被拆分成多个数据块，并被分散至不同的数据节点进行存放。

##核心概念##

###复制组###

由于采用 PC 服务器内置物理盘，当前大部分分布式数据库无法在硬件设备出现故障时保证单一设备中数据的可靠性与持久性。因此 SequoiaDB 巨杉数据库采用数据多副本存放的机制，将编目节点与数据节点所存放的数据以节点为单位进行复制，多个拥有相同数据拷贝的节点被称为数据复制组。一般来说，复制组、数据分片和数据分区均代表同样的含义。

###副本###

每个复制组内的多个节点被称为数据副本，在 SequoiaDB 巨杉数据库中每个复制组最多支持 7 个数据副本。

由于复制组内的逻辑节点互为备份，配置了多个数据副本的 SequoiaDB 巨杉数据库原生提供高可用与容灾机制。用户可以通过添加复制组或分区的数量实现整个存储引擎集群的水平弹性扩展，也可以通过添加复制组内副本的数量实现更高的安全性以及提升读写分离的并发性。

###一致性###

复制组内部的多个数据副本之间可以同时使用强一致或最终一致的数据同步方式，用户可以基于节点或表（集合）级别进行相应的配置。整个集群内部数据的 ACID 与分布式事务完全由数据库存储引擎支持。

##整体架构##

SequoiaDB 巨杉数据库集群分为数据库存储引擎与数据库实例。

在当前版本中，SequoiaDB 巨杉数据库支持多达 6 种不同数据服务实例，包括针对结构化数据的 MySQL、MariaDB、PostgreSQL 与 SparkSQL 实例；针对半结构化数据的 JSON 实例；以及针对非结构化数据的 S3 对象存储实例。

SequoiaDB 巨杉数据库的数据库存储引擎则包括协调节点、编目节点与数据节点三种类型的服务。数据节点与编目节点各自以多副本的形式构成一个个复制组。

数据库存储引擎与数据库实例均支持水平弹性扩展，任何角色的节点均提供高可用冗余机制，不存在单点故障的可能。

![SequoiaDB巨杉数据库整体架构][all_arch]




[^_^]:
    本文使用到的所有链接及引用。
[engine]:manual/SequoiaDB_Intro/overall_arch.md#数据库存储引擎
[instance]:manual/SequoiaDB_Intro/overall_arch.md#数据库实例
[logical_arch]:images/SequoiaDB_Intro/overall_arch_logical.png
[engine_arch]:images/SequoiaDB_Intro/overall_arch_engine.png
[all_arch]:images/SequoiaDB_Intro/overall_arch_all.png